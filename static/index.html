<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Sleep Health & Stress Prediction</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Correct CSS link -->
    <link rel="stylesheet" href="/static/style.css" />
</head>
  <body>
    <div class="page-wrapper">
      <div class="container">
        <header class="header">
          <h1>Sleep Health &amp; Stress Prediction</h1>
          <p>
            Enter your daily health details to estimate your stress level and
            sleep score.
          </p>
        </header>

        <main>
          <form id="predictForm" class="form-card">
            <div class="form-group">
              <label for="age">Age</label>
              <input
                type="number"
                id="age"
                name="age"
                min="1"
                required
                placeholder="e.g. 25"
              />
            </div>

            <div class="form-group">
              <label for="gender">Gender</label>
              <select id="gender" name="gender" required>
                <option value="" disabled selected>Select gender</option>
                <option value="female">Female</option>
                <option value="male">Male</option>
                <option value="other">Other / Prefer not to say</option>
              </select>
            </div>

            <div class="form-group">
              <label for="sleep_duration">Sleep Duration (hours)</label>
              <input
                type="number"
                step="0.1"
                id="sleep_duration"
                name="sleep_duration"
                min="0"
                required
                placeholder="e.g. 7.5"
              />
            </div>

            <div class="form-group">
              <label for="sleep_quality"
                >Sleep Quality (1 = Poor, 5 = Excellent)</label
              >
              <input
                type="number"
                id="sleep_quality"
                name="sleep_quality"
                min="1"
                max="5"
                required
                placeholder="1 - 5"
              />
            </div>

            <div class="form-group">
              <label for="daily_steps">Daily Steps</label>
              <input
                type="number"
                id="daily_steps"
                name="daily_steps"
                min="0"
                required
                placeholder="e.g. 8000"
              />
            </div>

            <div class="form-group">
              <label for="heart_rate">Resting Heart Rate (bpm)</label>
              <input
                type="number"
                id="heart_rate"
                name="heart_rate"
                min="0"
                required
                placeholder="e.g. 70"
              />
            </div>

            <button type="submit" class="btn-submit">
              Predict Stress &amp; Sleep
            </button>

            <p id="errorMessage" class="error-message" aria-live="polite"></p>
          </form>

          <section id="resultSection" class="result-card hidden">
            <h2>Your Prediction</h2>
            <p>
              <strong>Predicted Stress Level:</strong>
              <span id="stressValue">--</span> / 100
            </p>
            <p>
              <strong>Sleep Score:</strong>
              <span id="sleepScoreValue">--</span> / 100
            </p>
          </section>
        </main>
      </div>
    </div>

    <script>
      const form = document.getElementById("predictForm");
      const errorMessage = document.getElementById("errorMessage");
      const resultSection = document.getElementById("resultSection");
      const stressValueEl = document.getElementById("stressValue");
      const sleepScoreValueEl = document.getElementById("sleepScoreValue");

      form.addEventListener("submit", async function (event) {
        event.preventDefault();
        errorMessage.textContent = "";

        const ageInput = document.getElementById("age");
        const genderSelect = document.getElementById("gender");
        const sleepDurationInput = document.getElementById("sleep_duration");
        const sleepQualityInput = document.getElementById("sleep_quality");
        const dailyStepsInput = document.getElementById("daily_steps");
        const heartRateInput = document.getElementById("heart_rate");

        const payload = {
          age: ageInput.value,
          gender: genderSelect.value,
          sleep_duration: sleepDurationInput.value,
          sleep_quality: sleepQualityInput.value,
          daily_steps: dailyStepsInput.value,
          heart_rate: heartRateInput.value,
        };

        try {
          const response = await fetch("/api/predict", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(payload),
          });

          const data = await response.json();

          if (!response.ok) {
            const message =
              data && data.error
                ? data.error
                : "An error occurred while predicting.";
            errorMessage.textContent = message;
            resultSection.classList.add("hidden");
            return;
          }

          stressValueEl.textContent = data.predicted_stress.toFixed(2);
          sleepScoreValueEl.textContent = data.sleep_score.toFixed(2);
          resultSection.classList.remove("hidden");
        } catch (error) {
          errorMessage.textContent =
            "Network error: unable to reach the server.";
          resultSection.classList.add("hidden");
        }
      });
    </script>
  </body>
</html>
