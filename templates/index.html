<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Sleep Health & Stress Predictor</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="dark-theme">

<!-- Splash Screen -->
<div id="splash">
    <div class="splash-inner">
        <div class="splash-icon">ðŸ˜´</div>
        <h1>Sleep Health &amp; Stress Predictor</h1>
        <p>Loading your wellness dashboard...</p>
    </div>
</div>

<div class="page-wrap">

    <!-- Header -->
    <header class="app-header">
        <div>
            <h1>Sleep Health &amp; Stress Predictor</h1>
            <p class="subtitle">
                Kaggle Sleep Health &amp; Lifestyle inspired â€¢
                Model accuracy â‰ˆ {{ model_acc_stress }}% (Stress),
                {{ model_acc_sleep }}% (Sleep)
            </p>
        </div>

        <button id="themeToggle" class="theme-toggle">ðŸŒ™ Dark</button>
    </header>

    <!-- Main Layout -->
    <main class="main-grid">

        <!-- Left: Form -->
        <section class="card form-card">
            <h2>Enter your daily health details</h2>

            <form action="{{ url_for('predict') }}" method="post" class="form-grid">

                <div class="form-group">
                    <label for="name">Name</label>
                    <input id="name" name="name" type="text" placeholder="Asifa" />
                </div>

                <div class="form-group">
                    <label for="age">Age</label>
                    <input id="age" name="age" type="number" min="12" max="80" value="23" required />
                </div>

                <div class="form-group">
                    <label for="gender">Gender</label>
                    <select id="gender" name="gender">
                        <option>Female</option>
                        <option>Male</option>
                        <option>Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="occupation">Occupation</label>
                    <select id="occupation" name="occupation">
                        <option>Student</option>
                        <option>Software Engineer</option>
                        <option>Teacher</option>
                        <option>Healthcare</option>
                        <option>Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="bmi_category">BMI Category</label>
                    <select id="bmi_category" name="bmi_category">
                        <option>Underweight</option>
                        <option selected>Normal</option>
                        <option>Overweight</option>
                        <option>Obese</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="sleep_duration">Sleep Duration (hours)</label>
                    <input id="sleep_duration" name="sleep_duration" type="number"
                           step="0.5" min="3" max="12" value="7" />
                </div>

                <div class="form-group">
                    <label for="sleep_quality">Sleep Quality (1 = Poor, 5 = Excellent)</label>
                    <input id="sleep_quality" name="sleep_quality" type="number"
                           min="1" max="5" step="1" value="4" />
                </div>

                <div class="form-group">
                    <label for="bedtime">Bedtime</label>
                    <input id="bedtime" name="bedtime" type="time" value="23:00" />
                </div>

                <div class="form-group">
                    <label for="wakeup_time">Wake-up Time</label>
                    <input id="wakeup_time" name="wakeup_time" type="time" value="07:00" />
                </div>

                <div class="form-group">
                    <label for="activity_minutes">Physical Activity (min/day)</label>
                    <input id="activity_minutes" name="activity_minutes" type="number"
                           min="0" max="300" value="30" />
                </div>

                <div class="form-group">
                    <label for="daily_steps">Daily Steps</label>
                    <input id="daily_steps" name="daily_steps" type="number"
                           min="0" max="30000" value="7000" />
                </div>

                <div class="form-group">
                    <label for="resting_hr">Resting Heart Rate (bpm)</label>
                    <input id="resting_hr" name="resting_hr" type="number"
                           min="40" max="130" value="78" />
                </div>

                <div class="form-group">
                    <label for="current_stress">Current Stress Level (1â€“10)</label>
                    <input id="current_stress" name="current_stress" type="number"
                           min="1" max="10" value="5" />
                </div>

                <div class="form-group">
                    <label for="sleep_disorder">Sleep Disorder</label>
                    <select id="sleep_disorder" name="sleep_disorder">
                        <option selected>None</option>
                        <option>Insomnia</option>
                        <option>Sleep Apnea</option>
                        <option>Restless Legs</option>
                        <option>Other</option>
                    </select>
                </div>

                <div class="form-actions">
                    <button type="submit" class="primary-btn">
                        Predict Stress &amp; Sleep
                    </button>
                </div>

                <p class="accuracy-note">
                    Model training accuracy â‰ˆ {{ model_acc_stress }}% (Stress) &amp;
                    {{ model_acc_sleep }}% (Sleep)
                </p>
            </form>
        </section>

        <!-- Right: Prediction Summary -->
        <section class="summary-column">

            {% if result %}
            <!-- Main Metrics -->
            <div class="metrics-row">
                <div class="card metric-card">
                    <h3>Predicted Stress Level</h3>
                    <p class="metric-value">{{ result.pred_stress }} / 100</p>
                    <p class="metric-label">{{ result.stress_level }}</p>
                </div>

                <div class="card metric-card">
                    <h3>Sleep Score</h3>
                    <p class="metric-value">{{ result.sleep_score }} / 100</p>
                    <p class="metric-label">{{ result.sleep_duration }} h â€¢ {{ result.sleep_health }}</p>
                </div>
            </div>

            <!-- Pattern & Health -->
            <div class="card pattern-card">
                <h3>Sleep Pattern Type</h3>
                <p class="pattern-text">{{ result.pattern_type }}</p>
            </div>

            <div class="card pattern-card pattern-health">
                <h3>Sleep Health</h3>
                <p class="pattern-text">{{ result.sleep_health }}</p>
            </div>

            <!-- Suggestions -->
            <div class="card suggestions-card">
                <h3>Personalized Suggestions</h3>
                <ul>
                    {% for tip in result.suggestions %}
                    <li>{{ tip }}</li>
                    {% endfor %}
                </ul>
            </div>

            {% else %}
            <div class="card empty-state">
                <h3>Your prediction summary will appear here</h3>
                <p>Fill the form and click <strong>Predict Stress &amp; Sleep</strong> to view insights.</p>
            </div>
            {% endif %}

            <!-- Trends Section -->
            <section class="card trends-card">
                <div class="trends-header">
                    <div>
                        <h3>Your Stress &amp; Sleep Trends</h3>
                        <p class="small-text">
                            Uses your <code>history.csv</code> predictions to show change over time.
                        </p>
                    </div>
                    <button id="loadHistory" class="secondary-btn">
                        Load My History
                    </button>
                </div>

                <div class="charts-grid">
                    <div class="chart-block">
                        <h4>Stress Trend</h4>
                        <canvas id="stressChart"></canvas>
                    </div>
                    <div class="chart-block">
                        <h4>Sleep Score Trend</h4>
                        <canvas id="sleepChart"></canvas>
                    </div>
                </div>
            </section>
        </section>
    </main>

    <!-- Footer info similar to PPT -->
    <footer class="footer-card">
        <p>
            Built using machine-learning inspired by the
            <strong>Sleep Health &amp; Lifestyle</strong> Kaggle dataset.
            Focus areas: data preprocessing, correlation between sleep &amp; stress,
            model development and personalized recommendations.
        </p>
    </footer>
</div>

<script>
    // Splash hide
    window.addEventListener("load", () => {
        setTimeout(() => {
            document.body.classList.add("splash-hidden");
        }, 800);
    });

    // Theme toggle
    const themeToggle = document.getElementById("themeToggle");
    function applyTheme(theme) {
        if (theme === "light") {
            document.body.classList.remove("dark-theme");
            document.body.classList.add("light-theme");
            themeToggle.textContent = "â˜€ï¸ Light";
        } else {
            document.body.classList.remove("light-theme");
            document.body.classList.add("dark-theme");
            themeToggle.textContent = "ðŸŒ™ Dark";
        }
        localStorage.setItem("shsp-theme", theme);
    }
    themeToggle.addEventListener("click", () => {
        const current = document.body.classList.contains("light-theme") ? "light" : "dark";
        applyTheme(current === "light" ? "dark" : "light");
    });
    // Load saved theme
    const storedTheme = localStorage.getItem("shsp-theme") || "dark";
    applyTheme(storedTheme);

    // Charts
    let stressChart, sleepChart;

    function createCharts(data) {
        const ctxStress = document.getElementById("stressChart").getContext("2d");
        const ctxSleep = document.getElementById("sleepChart").getContext("2d");

        if (stressChart) stressChart.destroy();
        if (sleepChart) sleepChart.destroy();

        stressChart = new Chart(ctxStress, {
            type: "line",
            data: {
                labels: data.labels,
                datasets: [{
                    label: "Stress Level",
                    data: data.stress,
                    tension: 0.3
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: { suggestedMin: 0, suggestedMax: 100 }
                }
            }
        });

        sleepChart = new Chart(ctxSleep, {
            type: "line",
            data: {
                labels: data.labels,
                datasets: [{
                    label: "Sleep Score",
                    data: data.sleep,
                    tension: 0.3
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: { suggestedMin: 0, suggestedMax: 100 }
                }
            }
        });
    }

    document.getElementById("loadHistory").addEventListener("click", () => {
        fetch("/history")
            .then(r => r.json())
            .then(data => {
                if (!data.labels || data.labels.length === 0) {
                    alert("No history yet. Make some predictions first.");
                    return;
                }
                createCharts(data);
            })
            .catch(() => alert("Could not load history."));
    });
</script>

</body>
</html>
